{"ast":null,"code":"// frontend/src/components/InteractionHistory.jsx\nimport React from'react';import'./InteractionHistory.css';import WebSocketService from'./WebSocketService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const InteractionHistory=_ref=>{let{events=[],onClear,onGenerateReport,readyState}=_ref;const getStatusPill=()=>{switch(readyState){case 0:// CONNECTING\nreturn/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-connecting\",children:\"\\u8FDE\\u63A5\\u4E2D...\"});case 1:// OPEN\nreturn/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-open\",children:\"\\u5DF2\\u8FDE\\u63A5\"});case 2:// CLOSING\nreturn/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-closing\",children:\"\\u65AD\\u5F00\\u4E2D...\"});case 3:// CLOSED\nreturn/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-closed\",children:\"\\u670D\\u52A1\\u4E0D\\u53EF\\u7528\"});default:return/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-closed\",children:\"\\u670D\\u52A1\\u4E0D\\u53EF\\u7528\"});}};const handleReconnect=()=>{WebSocketService.reconnect();};const renderEvent=event=>{if(!event){return/*#__PURE__*/_jsx(\"p\",{children:\"\\u65E0\\u4E8B\\u4EF6\\u6570\\u636E\"});}const{type,payload,title,timestamp}=event;const time=timestamp?new Date(timestamp).toLocaleTimeString():'无时间戳';switch(type){case'agent_message':return/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 bg-blue-100 rounded\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-bold\",children:title||'智能体消息'}),/*#__PURE__*/_jsx(\"p\",{children:payload}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:time})]});case'agent_response':return/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 bg-green-100 rounded\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-bold\",children:title||'智能体响应'}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u667A\\u80FD\\u4F53:\"}),\" \",payload.agent]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u7ED3\\u679C:\"}),\" \",payload.result]}),payload.triggered_by&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u89E6\\u53D1\\u8005:\"}),\" \",payload.triggered_by]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:time})]});case'analysis_report':return/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 bg-purple-100 rounded\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-bold\",children:title||'分析报告'}),/*#__PURE__*/_jsx(\"pre\",{className:\"whitespace-pre-wrap\",children:payload.report}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:time})]});case'traffic_incident':return/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 bg-yellow-100 rounded\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-bold\",children:\"\\u4EA4\\u901A\\u4E8B\\u4EF6\\u62A5\\u544A\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u4F4D\\u7F6E: \",payload.location]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u63CF\\u8FF0: \",payload.description]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:time})]});case'error':return/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 bg-red-100 rounded\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-bold\",children:\"\\u9519\\u8BEF\"}),/*#__PURE__*/_jsx(\"p\",{children:payload}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:time})]});case'ping':return null;// 不显示ping消息\ndefault:return/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 bg-gray-100 rounded\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-bold\",children:[\"\\u672A\\u77E5\\u4E8B\\u4EF6: \",type]}),/*#__PURE__*/_jsx(\"pre\",{className:\"whitespace-pre-wrap\",children:JSON.stringify(payload,null,2)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:time})]});}};return/*#__PURE__*/_jsxs(\"div\",{className:\"interaction-record card\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"h2\",{className:\"card__title\",children:\"\\u4EA4\\u4E92\\u8BB0\\u5F55\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center'},children:[getStatusPill(),readyState!==1&&/*#__PURE__*/_jsx(\"button\",{onClick:handleReconnect,className:\"reconnect-btn\",style:{marginLeft:'1rem'},children:\"\\u91CD\\u8FDE\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onGenerateReport,className:\"generate-btn\",style:{marginLeft:'1rem'},children:\"\\u751F\\u6210\\u62A5\\u544A\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onClear,className:\"clear-btn\",style:{marginLeft:'1rem'},children:\"\\u6E05\\u7A7A\\u8BB0\\u5F55\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"history-scroll\",children:events.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"muted\",children:\"\\u6682\\u65E0\\u8BB0\\u5F55\\u3002\\u53D1\\u9001\\u6A21\\u5757\\u4EE5\\u67E5\\u770B\\u4EA4\\u4E92\\u5386\\u53F2\\u3002\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"history\",children:events.map((event,index)=>/*#__PURE__*/_jsx(\"li\",{children:renderEvent(event)},\"\".concat(event.type,\"-\").concat(event.timestamp||index,\"-\").concat(index)))})})]});};export default InteractionHistory;","map":{"version":3,"names":["React","WebSocketService","jsx","_jsx","jsxs","_jsxs","InteractionHistory","_ref","events","onClear","onGenerateReport","readyState","getStatusPill","className","children","handleReconnect","reconnect","renderEvent","event","type","payload","title","timestamp","time","Date","toLocaleTimeString","agent","result","triggered_by","report","location","description","JSON","stringify","style","display","justifyContent","alignItems","onClick","marginLeft","length","map","index","concat"],"sources":["/Users/Apple/Desktop/multi-agent-dsl-final/frontend/src/components/InteractionHistory.jsx"],"sourcesContent":["// frontend/src/components/InteractionHistory.jsx\nimport React from 'react';\nimport './InteractionHistory.css';\nimport WebSocketService from './WebSocketService';\n\nconst InteractionHistory = ({ events = [], onClear, onGenerateReport, readyState }) => {\n  const getStatusPill = () => {\n    switch (readyState) {\n      case 0: // CONNECTING\n        return <span className=\"pill pill-status-connecting\">连接中...</span>;\n      case 1: // OPEN\n        return <span className=\"pill pill-status-open\">已连接</span>;\n      case 2: // CLOSING\n        return <span className=\"pill pill-status-closing\">断开中...</span>;\n      case 3: // CLOSED\n        return <span className=\"pill pill-status-closed\">服务不可用</span>;\n      default:\n        return <span className=\"pill pill-status-closed\">服务不可用</span>;\n    }\n  };\n\n  const handleReconnect = () => {\n    WebSocketService.reconnect();\n  };\n\n  const renderEvent = (event) => {\n    if (!event) {\n      return <p>无事件数据</p>;\n    }\n\n    const { type, payload, title, timestamp } = event;\n    const time = timestamp ? new Date(timestamp).toLocaleTimeString() : '无时间戳';\n\n    switch (type) {\n      case 'agent_message':\n        return (\n          <div className=\"p-2 bg-blue-100 rounded\">\n            <p className=\"font-bold\">{title || '智能体消息'}</p>\n            <p>{payload}</p>\n            <p className=\"text-xs text-gray-500\">{time}</p>\n          </div>\n        );\n      case 'agent_response':\n        return (\n          <div className=\"p-2 bg-green-100 rounded\">\n            <p className=\"font-bold\">{title || '智能体响应'}</p>\n            <p><strong>智能体:</strong> {payload.agent}</p>\n            <p><strong>结果:</strong> {payload.result}</p>\n            {payload.triggered_by && <p><strong>触发者:</strong> {payload.triggered_by}</p>}\n            <p className=\"text-xs text-gray-500\">{time}</p>\n          </div>\n        );\n      case 'analysis_report':\n        return (\n          <div className=\"p-2 bg-purple-100 rounded\">\n            <p className=\"font-bold\">{title || '分析报告'}</p>\n            <pre className=\"whitespace-pre-wrap\">{payload.report}</pre>\n            <p className=\"text-xs text-gray-500\">{time}</p>\n          </div>\n        );\n      case 'traffic_incident':\n        return (\n          <div className=\"p-2 bg-yellow-100 rounded\">\n            <p className=\"font-bold\">交通事件报告</p>\n            <p>位置: {payload.location}</p>\n            <p>描述: {payload.description}</p>\n            <p className=\"text-xs text-gray-500\">{time}</p>\n          </div>\n        );\n      case 'error':\n        return (\n          <div className=\"p-2 bg-red-100 rounded\">\n            <p className=\"font-bold\">错误</p>\n            <p>{payload}</p>\n            <p className=\"text-xs text-gray-500\">{time}</p>\n          </div>\n        );\n      case 'ping':\n        return null; // 不显示ping消息\n      default:\n        return (\n          <div className=\"p-2 bg-gray-100 rounded\">\n            <p className=\"font-bold\">未知事件: {type}</p>\n            <pre className=\"whitespace-pre-wrap\">{JSON.stringify(payload, null, 2)}</pre>\n            <p className=\"text-xs text-gray-500\">{time}</p>\n          </div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"interaction-record card\">\n      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n        <h2 className=\"card__title\">交互记录</h2>\n        <div style={{ display: 'flex', alignItems: 'center' }}>\n          {getStatusPill()}\n          {readyState !== 1 && (\n            <button onClick={handleReconnect} className=\"reconnect-btn\" style={{ marginLeft: '1rem' }}>重连</button>\n          )}\n          <button onClick={onGenerateReport} className=\"generate-btn\" style={{ marginLeft: '1rem' }}>生成报告</button>\n          <button onClick={onClear} className=\"clear-btn\" style={{ marginLeft: '1rem' }}>清空记录</button>\n        </div>\n      </div>\n      <div className=\"history-scroll\">\n        {events.length === 0 ? (\n          <p className=\"muted\">暂无记录。发送模块以查看交互历史。</p>\n        ) : (\n          <ul className=\"history\">\n            {events.map((event, index) => (\n              <li key={`${event.type}-${event.timestamp || index}-${index}`}>{renderEvent(event)}</li>\n            ))}\n          </ul>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default InteractionHistory;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}