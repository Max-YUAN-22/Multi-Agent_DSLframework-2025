{"ast":null,"code":"import _objectSpread from\"/Users/Apple/Desktop/multi-agent-dsl-final/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useReducer,useCallback,useRef,useEffect,useState}from'react';import WebSocketService from'../components/WebSocketService';import{jsx as _jsx}from\"react/jsx-runtime\";const EventContext=/*#__PURE__*/createContext();const initialState={events:[],traffic:{},weather:{},parking:{},safety:{}};const eventReducer=(state,action)=>{switch(action.type){case'ADD_EVENT':return _objectSpread(_objectSpread({},state),{},{events:[action.payload,...state.events]});case'CLEAR_EVENTS':return _objectSpread(_objectSpread({},state),{},{events:[]});case'SET_TRAFFIC':return _objectSpread(_objectSpread({},state),{},{traffic:action.payload});case'SET_WEATHER':return _objectSpread(_objectSpread({},state),{},{weather:action.payload});case'SET_PARKING':return _objectSpread(_objectSpread({},state),{},{parking:action.payload});case'SET_SAFETY':return _objectSpread(_objectSpread({},state),{},{safety:action.payload});default:return state;}};export const EventProvider=_ref=>{let{children}=_ref;const[state,dispatch]=useReducer(eventReducer,initialState);const idCounter=useRef(0);const[readyState,setReadyState]=useState(0);// 0 = connecting, 1 = open, 2 = closing, 3 = closed\nuseEffect(()=>{const onMessage=parsedData=>{try{if(!parsedData){console.error(\"Received empty WebSocket message data\");return;}const newEvent=_objectSpread(_objectSpread({},parsedData),{},{id:idCounter.current++,at:new Date().toLocaleTimeString()});dispatch({type:'ADD_EVENT',payload:newEvent});}catch(error){console.error(\"Error processing WebSocket message:\",error);console.error(\"Received data:\",parsedData);const errorEvent={id:idCounter.current++,at:new Date().toLocaleTimeString(),type:'error',title:'WebSocket Processing Error',payload:{details:\"Failed to process message: \".concat(JSON.stringify(parsedData))}};dispatch({type:'ADD_EVENT',payload:errorEvent});}};const onConnect=()=>setReadyState(1);const onDisconnect=()=>setReadyState(3);WebSocketService.on('message',onMessage);WebSocketService.on('connect',onConnect);WebSocketService.on('disconnect',onDisconnect);},[]);const clearEvents=useCallback(()=>{dispatch({type:'CLEAR_EVENTS'});},[dispatch]);const sendAgentAction=useCallback(function(agent,payload){let workflow=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let message;if(workflow){message={type:'message',message_type:'run_workflow',workflow_name:workflow,data:payload};}else{message={type:'message',message_type:agent,data:payload};}console.log('Sending WebSocket message via EventContext:',message);WebSocketService.send(message);},[]);return/*#__PURE__*/_jsx(EventContext.Provider,{value:{state,dispatch,readyState,clearEvents,sendAgentAction},children:children});};export const useEventContext=()=>{const context=useContext(EventContext);if(!context){throw new Error('useEventContext must be used within an EventProvider');}return context;};export default EventContext;","map":{"version":3,"names":["React","createContext","useContext","useReducer","useCallback","useRef","useEffect","useState","WebSocketService","jsx","_jsx","EventContext","initialState","events","traffic","weather","parking","safety","eventReducer","state","action","type","_objectSpread","payload","EventProvider","_ref","children","dispatch","idCounter","readyState","setReadyState","onMessage","parsedData","console","error","newEvent","id","current","at","Date","toLocaleTimeString","errorEvent","title","details","concat","JSON","stringify","onConnect","onDisconnect","on","clearEvents","sendAgentAction","agent","workflow","arguments","length","undefined","message","message_type","workflow_name","data","log","send","Provider","value","useEventContext","context","Error"],"sources":["/Users/Apple/Desktop/multi-agent-dsl-final/frontend/src/contexts/EventContext.js"],"sourcesContent":["import React, { createContext, useContext, useReducer, useCallback, useRef, useEffect, useState } from 'react';\nimport WebSocketService from '../components/WebSocketService';\n\nconst EventContext = createContext();\n\nconst initialState = {\n  events: [],\n  traffic: {},\n  weather: {},\n  parking: {},\n  safety: {},\n};\n\nconst eventReducer = (state, action) => {\n  switch (action.type) {\n    case 'ADD_EVENT':\n      return { ...state, events: [action.payload, ...state.events] };\n    case 'CLEAR_EVENTS':\n      return { ...state, events: [] };\n    case 'SET_TRAFFIC':\n      return { ...state, traffic: action.payload };\n    case 'SET_WEATHER':\n      return { ...state, weather: action.payload };\n    case 'SET_PARKING':\n      return { ...state, parking: action.payload };\n    case 'SET_SAFETY':\n      return { ...state, safety: action.payload };\n    default:\n      return state;\n  }\n};\n\nexport const EventProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(eventReducer, initialState);\n  const idCounter = useRef(0);\n  const [readyState, setReadyState] = useState(0); // 0 = connecting, 1 = open, 2 = closing, 3 = closed\n\n  useEffect(() => {\n    const onMessage = (parsedData) => {\n      try {\n        if (!parsedData) {\n          console.error(\"Received empty WebSocket message data\");\n          return;\n        }\n        const newEvent = {\n          ...parsedData,\n          id: idCounter.current++,\n          at: new Date().toLocaleTimeString(),\n        };\n        dispatch({ type: 'ADD_EVENT', payload: newEvent });\n      } catch (error) {\n        console.error(\"Error processing WebSocket message:\", error);\n        console.error(\"Received data:\", parsedData);\n        const errorEvent = {\n          id: idCounter.current++,\n          at: new Date().toLocaleTimeString(),\n          type: 'error',\n          title: 'WebSocket Processing Error',\n          payload: { details: `Failed to process message: ${JSON.stringify(parsedData)}` },\n        };\n        dispatch({ type: 'ADD_EVENT', payload: errorEvent });\n      }\n    };\n\n    const onConnect = () => setReadyState(1);\n    const onDisconnect = () => setReadyState(3);\n\n    WebSocketService.on('message', onMessage);\n    WebSocketService.on('connect', onConnect);\n    WebSocketService.on('disconnect', onDisconnect);\n  }, []);\n\n  const clearEvents = useCallback(() => {\n    dispatch({ type: 'CLEAR_EVENTS' });\n  }, [dispatch]);\n\n  const sendAgentAction = useCallback((agent, payload, workflow = null) => {\n    let message;\n    if (workflow) {\n      message = {\n        type: 'message',\n        message_type: 'run_workflow',\n        workflow_name: workflow,\n        data: payload,\n      };\n    } else {\n      message = {\n        type: 'message',\n        message_type: agent,\n        data: payload,\n      };\n    }\n    console.log('Sending WebSocket message via EventContext:', message);\n    WebSocketService.send(message);\n  }, []);\n\n  return (\n    <EventContext.Provider value={{ state, dispatch, readyState, clearEvents, sendAgentAction }}>\n      {children}\n    </EventContext.Provider>\n  );\n};\n\nexport const useEventContext = () => {\n  const context = useContext(EventContext);\n  if (!context) {\n    throw new Error('useEventContext must be used within an EventProvider');\n  }\n  return context;\n};\n\nexport default EventContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}