{"ast":null,"code":"// frontend/src/components/InteractionHistory.jsx\nimport React,{useState}from'react';import'./InteractionHistory.css';import WebSocketService from'./WebSocketService';import AgentInteractionFlow from'./AgentInteractionFlow';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const InteractionHistory=_ref=>{let{events=[],onClear,onGenerateReport,onOpenReportSidebar,showReportsOnly,onToggleReportsOnly,readyState,connectionStats,connectionError,isRetrying,onRetryConnection}=_ref;const[selectedSentEvent,setSelectedSentEvent]=useState(null);const[expandedEvents,setExpandedEvents]=useState(new Set());const getStatusPill=()=>{if(isRetrying){return/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-connecting\",children:\"\\uD83D\\uDD04 \\u91CD\\u8FDE\\u4E2D / Retrying...\"});}if(connectionError){return/*#__PURE__*/_jsxs(\"div\",{className:\"connection-error-container\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-closed\",children:\"\\u274C \\u8FDE\\u63A5\\u9519\\u8BEF / Connection Error\"}),/*#__PURE__*/_jsx(\"button\",{className:\"retry-button\",onClick:onRetryConnection,disabled:isRetrying,children:\"\\uD83D\\uDD04 \\u91CD\\u8BD5 / Retry\"})]});}switch(readyState){case 0:// CONNECTING\nreturn/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-connecting\",children:\"\\uD83D\\uDD04 \\u8FDE\\u63A5\\u4E2D / Connecting...\"});case 1:// OPEN\nreturn/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-open\",children:\"\\u2705 \\u5DF2\\u8FDE\\u63A5 / Connected\"});case 2:// CLOSING\nreturn/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-closing\",children:\"\\u23F3 \\u65AD\\u5F00\\u4E2D / Disconnecting...\"});case 3:// CLOSED\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"connection-error-container\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-closed\",children:\"\\u274C \\u670D\\u52A1\\u4E0D\\u53EF\\u7528 / Service Unavailable\"}),/*#__PURE__*/_jsx(\"button\",{className:\"retry-button\",onClick:onRetryConnection,disabled:isRetrying,children:\"\\uD83D\\uDD04 \\u91CD\\u8BD5 / Retry\"})]});default:return/*#__PURE__*/_jsxs(\"div\",{className:\"connection-error-container\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"pill pill-status-closed\",children:\"\\u274C \\u670D\\u52A1\\u4E0D\\u53EF\\u7528 / Service Unavailable\"}),/*#__PURE__*/_jsx(\"button\",{className:\"retry-button\",onClick:onRetryConnection,disabled:isRetrying,children:\"\\uD83D\\uDD04 \\u91CD\\u8BD5 / Retry\"})]});}};const handleReconnect=()=>{WebSocketService.reconnect();};// 获取事件摘要\nconst getEventSummary=event=>{switch(event.type){case'main_task_result':return\"\".concat(event.payload.agent,\": \").concat(event.payload.result.substring(0,50),\"...\");case'coordination_result':return\"\\u534F\\u540C\\u5B8C\\u6210: \".concat(event.payload.total_agents,\"\\u4E2A\\u667A\\u80FD\\u4F53\\u54CD\\u5E94\");case'workflow_complete':return'工作流完成';case'agent_response':return\"\".concat(event.payload.agent,\": \").concat(event.payload.result.substring(0,50),\"...\");case'agent_message':return event.payload.substring(0,50)+'...';case'analysis_report':return'分析报告已生成';case'simulation_log':return event.payload.details?event.payload.details.substring(0,50)+'...':'模拟日志';default:return event.title||event.type;}};const getEventIcon=type=>{const icons={'workflow_start':'🚀','main_task_result':'👑',// Master Agent 使用皇冠图标\n'coordination_start':'🤝','coordination_result':'🎯','workflow_complete':'🏁','agent_message':'🤖','agent_response':'💬','analysis_report':'📊','traffic_incident':'🚗','weather_alert':'🌧️','parking_update':'🅿️','safety_inspection':'🛡️','autonomous_driving':'🚙','traffic_monitor':'🚦','simulation_log':'📝','error':'❌','ping':'📡','broadcast':'📡','main_coordination':'👑','sub_agent_coordination':'🤝','sub_agent_processing':'⚙️','sub_agent_completed':'✅','result_summary':'📋','default':'📝'};return icons[type]||icons['default'];};const getEventTypeLabel=type=>{const labels={'workflow_start':'工作流启动 / Workflow Start','main_task_result':'主智能体协调 / Master Agent Coordination','coordination_start':'子智能体协调 / Sub Agent Coordination','coordination_result':'子智能体协同 / Sub Agent Collaboration','workflow_complete':'工作流完成 / Workflow Complete','agent_message':'智能体消息 / Agent Message','agent_response':'智能体响应 / Agent Response','analysis_report':'分析报告 / Analysis Report','traffic_incident':'交通事件 / Traffic Incident','weather_alert':'天气警报 / Weather Alert','parking_update':'停车更新 / Parking Update','safety_inspection':'安全检查 / Safety Inspection','autonomous_driving':'自动驾驶 / Autonomous Driving','traffic_monitor':'交通监控 / Traffic Monitor','simulation_log':'模拟日志 / Simulation Log','error':'错误 / Error','ping':'心跳 / Ping','broadcast':'广播消息 / Broadcast','main_coordination':'主智能体协调 / Main Coordination','sub_agent_coordination':'子智能体协调 / Sub Agent Coordination','sub_agent_processing':'子智能体处理 / Sub Agent Processing','sub_agent_completed':'子智能体完成 / Sub Agent Completed','result_summary':'结果汇总 / Result Summary','default':'未知事件 / Unknown Event'};return labels[type]||labels['default'];};const renderEvent=(event,index)=>{if(!event){return/*#__PURE__*/_jsx(\"p\",{children:\"No event data\"});}const{type,payload,title,timestamp}=event;const time=timestamp?new Date(timestamp).toLocaleTimeString():'No timestamp';const icon=getEventIcon(type);const typeLabel=getEventTypeLabel(type);const eventCard=/*#__PURE__*/_jsxs(\"div\",{className:\"event-card event-\".concat(type),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"event-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"event-icon\",children:icon}),/*#__PURE__*/_jsxs(\"div\",{className:\"event-info\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"event-title\",children:title||typeLabel}),/*#__PURE__*/_jsx(\"span\",{className:\"event-time\",children:time})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"event-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"action-btn view-btn\",onClick:()=>viewEventDetails(event),title:\"\\u67E5\\u770B\\u8BE6\\u60C5 / View Details\",children:\"\\uD83D\\uDC41\\uFE0F\"}),type==='agent_response'&&/*#__PURE__*/_jsx(\"button\",{className:\"action-btn replay-btn\",onClick:()=>replayEvent(event),title:\"\\u91CD\\u653E\\u4E8B\\u4EF6 / Replay Event\",children:\"\\uD83D\\uDD04\"}),type==='error'&&/*#__PURE__*/_jsx(\"button\",{className:\"action-btn retry-btn\",onClick:()=>retryEvent(event),title:\"\\u91CD\\u8BD5 / Retry\",children:\"\\u26A1\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"event-content\",children:renderEventContent(type,payload)})]},\"\".concat(type,\"-\").concat(timestamp||index,\"-\").concat(index));return eventCard;};const renderEventContent=(type,payload)=>{switch(type){case'workflow_start':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsx(\"p\",{className:\"payload-text\",children:payload})});case'main_task_result':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"payload-text\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[payload.agent,\":\"]}),\" \",payload.result]})});case'coordination_start':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsx(\"p\",{className:\"payload-text\",children:payload})});case'coordination_result':return/*#__PURE__*/_jsxs(\"div\",{className:\"event-payload\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"payload-text\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u534F\\u540C\\u5B8C\\u6210:\"}),\" \",payload.total_agents,\"\\u4E2A\\u667A\\u80FD\\u4F53\\u54CD\\u5E94\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"responses-summary\",children:payload.responses.map((response,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"response-summary\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"response-agent\",children:[response.agent,\":\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"response-text\",children:[response.result.substring(0,100),\"...\"]})]},index))})]});case'workflow_complete':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsx(\"p\",{className:\"payload-text\",children:payload})});case'agent_message':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsx(\"p\",{className:\"payload-text\",children:payload})});case'agent_response':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"payload-text\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[payload.agent,\":\"]}),\" \",payload.result]})});case'analysis_report':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"report-content\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"report-title\",children:\"\\uD83D\\uDCCA \\u57CE\\u5E02\\u5206\\u6790\\u62A5\\u544A / City Analysis Report\"}),/*#__PURE__*/_jsx(\"div\",{className:\"report-body\",children:payload&&payload.report?/*#__PURE__*/_jsx(\"div\",{className:\"report-text\",children:payload.report.split('\\n').map((line,index)=>/*#__PURE__*/_jsx(\"p\",{className:\"report-paragraph\",children:line},index))}):/*#__PURE__*/_jsx(\"p\",{className:\"report-text\",children:\"\\u62A5\\u544A\\u5185\\u5BB9\\u52A0\\u8F7D\\u4E2D... / Report content loading...\"})})]})});case'traffic_incident':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"payload-text\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u4F4D\\u7F6E:\"}),\" \",payload.location,\" - \",payload.description]})});case'weather_alert':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"payload-text\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u533A\\u57DF:\"}),\" \",payload.area,\" - \",/*#__PURE__*/_jsx(\"strong\",{children:\"\\u7C7B\\u578B:\"}),\" \",payload.alert_type,\" - \",/*#__PURE__*/_jsx(\"strong\",{children:\"\\u4E25\\u91CD\\u7A0B\\u5EA6:\"}),\" \",payload.severity]})});case'parking_update':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"payload-text\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u4F4D\\u7F6E:\"}),\" \",payload.location,\" - \",/*#__PURE__*/_jsx(\"strong\",{children:\"\\u53EF\\u7528\\u8F66\\u4F4D:\"}),\" \",payload.available_spots]})});case'safety_inspection':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"payload-text\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u4F4D\\u7F6E:\"}),\" \",payload.location,\" - \",/*#__PURE__*/_jsx(\"strong\",{children:\"\\u5B89\\u5168\\u72B6\\u6001:\"}),\" \",payload.safety_status,\" - \",/*#__PURE__*/_jsx(\"strong\",{children:\"\\u9700\\u8981\\u4EBA\\u5DE5\\u5E72\\u9884:\"}),\" \",payload.require_human_intervention?'是':'否']})});case'autonomous_driving':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"payload-text\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u8D77\\u70B9:\"}),\" \",payload.start_location,\" - \",/*#__PURE__*/_jsx(\"strong\",{children:\"\\u7EC8\\u70B9:\"}),\" \",payload.end_location,\" - \",/*#__PURE__*/_jsx(\"strong\",{children:\"\\u4E58\\u5BA2\\u6570:\"}),\" \",payload.passengers]})});case'traffic_monitor':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"payload-text\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u4EA4\\u901A\\u76D1\\u63A7\\u6570\\u636E:\"}),\" \",JSON.stringify(payload)]})});case'simulation_log':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsx(\"p\",{className:\"payload-text\",children:payload.details||payload})});case'error':return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsx(\"p\",{className:\"payload-error\",children:payload})});case'ping':return null;// Don't display ping messages\ndefault:return/*#__PURE__*/_jsx(\"div\",{className:\"event-payload\",children:/*#__PURE__*/_jsx(\"p\",{className:\"payload-text\",children:JSON.stringify(payload)})});}};const viewEventDetails=event=>{alert(\"\\u4E8B\\u4EF6\\u8BE6\\u60C5 / Event Details\\n\\n\\u7C7B\\u578B / Type: \".concat(getEventTypeLabel(event.type),\"\\n\\u65F6\\u95F4 / Time: \").concat(event.timestamp,\"\\n\\n\\u8BE6\\u7EC6\\u4FE1\\u606F\\u5C06\\u5728\\u6A21\\u6001\\u6846\\u4E2D\\u663E\\u793A / Detailed information will be shown in a modal.\"));};const replayEvent=event=>{if(confirm(\"\\u786E\\u5B9A\\u8981\\u91CD\\u653E\\u6B64\\u4E8B\\u4EF6\\u5417\\uFF1F / Are you sure you want to replay this event?\")){// 这里可以添加重放逻辑\nalert('事件已重放 / Event replayed successfully!');}};const retryEvent=event=>{if(confirm(\"\\u786E\\u5B9A\\u8981\\u91CD\\u8BD5\\u6B64\\u4E8B\\u4EF6\\u5417\\uFF1F / Are you sure you want to retry this event?\")){// 这里可以添加重试逻辑\nalert('事件已重试 / Event retried successfully!');}};const getEventStats=()=>{const total=filteredEvents.length;const byType=filteredEvents.reduce((acc,event)=>{acc[event.type]=(acc[event.type]||0)+1;return acc;},{});return{total,byType};};// 获取发送的事件（用户主动发送的事件）\nconst getSentEvents=()=>{const sentEventTypes=['weather_alert','parking_update','safety_inspection','autonomous_driving','traffic_monitor','broadcast','main_coordination','sub_agent_coordination','sub_agent_processing','sub_agent_completed','result_summary','coordination_result','analysis_report'];return events.filter(event=>sentEventTypes.includes(event.type));};// 获取发送事件数量\nconst getSentEventsCount=()=>{return getSentEvents().length;};// 获取发送事件摘要\nconst getSentEventSummary=event=>{if(!event){return'未知事件';}// 如果有title，优先使用title\nif(event.title){return event.title;}// 如果有payload，根据类型生成摘要\nif(event.payload){switch(event.type){case'weather_alert':return\"\\u533A\\u57DF: \".concat(event.payload.area||'未知',\" - \\u7C7B\\u578B: \").concat(event.payload.alert_type||'未知');case'parking_update':return\"\\u4F4D\\u7F6E: \".concat(event.payload.location||'未知',\" - \\u53EF\\u7528\\u8F66\\u4F4D: \").concat(event.payload.available_spots||'未知');case'safety_inspection':return\"\\u4F4D\\u7F6E: \".concat(event.payload.location||'未知',\" - \\u72B6\\u6001: \").concat(event.payload.safety_status||'未知');case'autonomous_driving':return\"\\u8D77\\u70B9: \".concat(event.payload.start_location||'未知',\" - \\u7EC8\\u70B9: \").concat(event.payload.end_location||'未知');case'traffic_monitor':return\"\\u4EA4\\u901A\\u76D1\\u63A7\\u6570\\u636E\";case'broadcast':return event.payload.payload||event.payload.message||'广播消息';case'main_coordination':return event.payload.result||'主智能体协调任务';case'sub_agent_coordination':return event.payload||'子智能体协调开始';case'sub_agent_processing':return event.payload.agent||'子智能体处理中';case'sub_agent_completed':return event.payload.result||'子智能体处理完成';case'result_summary':return\"\\u603B\\u8BA1: \".concat(event.payload.total_agents||0,\" \\u4E2A\\u667A\\u80FD\\u4F53, \\u6210\\u529F: \").concat(event.payload.successful_agents||0,\" \\u4E2A\");case'coordination_result':return event.payload.summary||'智能体协同完成';case'analysis_report':return event.payload.report?event.payload.report.substring(0,100)+'...':'分析报告';default:return event.type||'未知事件';}}return event.type||'未知事件';};// 获取与发送事件相关的响应事件\nconst getRelatedEvents=sentEvent=>{if(!sentEvent||!sentEvent.timestamp){return[];}const sentTime=new Date(sentEvent.timestamp);const timeWindow=10*60*1000;// 增加到10分钟时间窗口\n// 定义智能体响应事件类型\nconst responseEventTypes=['workflow_start','main_task_result','coordination_start','coordination_result','workflow_complete','agent_message','agent_response','analysis_report','simulation_log'];return events.filter(event=>{if(!event||!event.timestamp)return false;const eventTime=new Date(event.timestamp);const timeDiff=Math.abs(eventTime.getTime()-sentTime.getTime());// 在时间窗口内，是响应事件类型，且不是发送事件本身\nreturn timeDiff<=timeWindow&&responseEventTypes.includes(event.type)&&event.type!==sentEvent.type;}).sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));};// 过滤事件 - 如果只显示报告，则只显示报告类型的事件\nconst getFilteredEvents=()=>{if(showReportsOnly){return events.filter(event=>event.type==='analysis_report');}return events;};const filteredEvents=getFilteredEvents();const stats=getEventStats();return/*#__PURE__*/_jsxs(\"div\",{className:\"interaction-record card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"history-header\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"card__title\",children:\"\\uD83D\\uDCCA \\u4EA4\\u4E92\\u5386\\u53F2 / Interaction History\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-controls\",children:[getStatusPill(),connectionStats&&/*#__PURE__*/_jsxs(\"span\",{className:\"pill pill-info\",children:[\"\\uD83D\\uDCE1 \",connectionStats.userId?connectionStats.userId.substring(0,8)+'...':'Unknown']})]}),connectionError&&/*#__PURE__*/_jsxs(\"div\",{className:\"connection-error-message\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"error-icon\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsx(\"span\",{className:\"error-text\",children:connectionError})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"connection-info\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"connection-details\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"connection-item\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u6D88\\u606F\\u6570 / Messages:\"}),\" \",events.length]}),/*#__PURE__*/_jsxs(\"span\",{className:\"connection-item\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u540E\\u7AEF / Backend:\"}),\" http://localhost:8008\"]}),connectionStats&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"connection-item\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u7528\\u6237ID / User ID:\"}),\" \",connectionStats.userId]}),/*#__PURE__*/_jsxs(\"span\",{className:\"connection-item\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u6D3B\\u8DC3\\u8FDE\\u63A5 / Active Connections:\"}),\" \",connectionStats.activeConnections,\"/\",connectionStats.totalConnections]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"history-controls\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onOpenReportSidebar,className:\"report-sidebar-btn\",children:\"\\uD83D\\uDCCA \\u4EA4\\u4E92\\u62A5\\u544A / Interaction Report\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onGenerateReport,className:\"generate-btn\",children:\"\\uD83D\\uDCC4 \\u751F\\u6210\\u62A5\\u544A / Generate Report\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onClear,className:\"clear-btn\",children:\"\\uD83D\\uDDD1\\uFE0F \\u6E05\\u7A7A\\u5386\\u53F2 / Clear History\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onToggleReportsOnly,className:\"view-reports-btn \".concat(showReportsOnly?'active':''),children:showReportsOnly?'📋 显示全部 / Show All':'📊 查看报告 / View Reports'})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"history-layout\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sent-events-sidebar\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:showReportsOnly?'📊 报告信息 / Report Info':'📤 发送的事件 / Sent Events'}),/*#__PURE__*/_jsx(\"span\",{className:\"event-count\",children:showReportsOnly?\"\".concat(filteredEvents.length,\" \\u4E2A\\u62A5\\u544A\"):\"\".concat(getSentEventsCount(),\" \\u4E2A\\u4E8B\\u4EF6\")})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sent-events-list\",children:showReportsOnly?// 报告模式：显示报告相关信息\nfilteredEvents.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"empty-icon\",children:\"\\uD83D\\uDCC4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"empty-text\",children:\"\\u6682\\u65E0\\u751F\\u6210\\u7684\\u62A5\\u544A / No reports generated yet\"}),/*#__PURE__*/_jsx(\"p\",{className:\"empty-subtext\",children:\"\\u70B9\\u51FB\\\"\\u751F\\u6210\\u62A5\\u544A\\\"\\u6309\\u94AE\\u521B\\u5EFA\\u62A5\\u544A / Click \\\"Generate Report\\\" to create reports\"})]}):filteredEvents.map((report,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"report-summary-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"event-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"event-icon\",children:\"\\uD83D\\uDCCA\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"event-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"event-title\",children:report.title||'城市分析报告'}),/*#__PURE__*/_jsx(\"div\",{className:\"event-meta\",children:/*#__PURE__*/_jsx(\"span\",{className:\"event-time\",children:report.timestamp?new Date(report.timestamp).toLocaleTimeString():'未知时间'})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"event-summary\",children:report.payload&&report.payload.report?\"\\u62A5\\u544A\\u6458\\u8981: \".concat(report.payload.report.substring(0,100),\"...\"):'报告内容加载中...'})]},index)):// 正常模式：显示发送事件\ngetSentEvents().length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"empty-icon\",children:\"\\uD83D\\uDCED\"}),/*#__PURE__*/_jsx(\"p\",{className:\"empty-text\",children:\"\\u6682\\u65E0\\u53D1\\u9001\\u4E8B\\u4EF6 / No sent events yet\"}),/*#__PURE__*/_jsx(\"p\",{className:\"empty-subtext\",children:\"\\u53D1\\u9001\\u4EFB\\u52A1\\u4EE5\\u67E5\\u770B\\u4E8B\\u4EF6\\u8BE6\\u60C5 / Send tasks to view event details\"})]}):getSentEvents().map((event,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"sent-event-item \".concat(selectedSentEvent===index?'selected':''),onClick:()=>setSelectedSentEvent(index),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"event-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"event-icon\",children:getEventIcon(event.type)}),/*#__PURE__*/_jsxs(\"div\",{className:\"event-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"event-title\",children:getEventTypeLabel(event.type)}),/*#__PURE__*/_jsx(\"div\",{className:\"event-meta\",children:/*#__PURE__*/_jsx(\"span\",{className:\"event-time\",children:event.timestamp?new Date(event.timestamp).toLocaleTimeString():'未知时间'})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"event-summary\",children:getSentEventSummary(event)})]},index))})]}),/*#__PURE__*/_jsx(\"div\",{className:\"interactions-detail\",children:selectedSentEvent!==null?/*#__PURE__*/_jsxs(\"div\",{className:\"detail-view\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83E\\uDD16 \\u667A\\u80FD\\u4F53\\u4EA4\\u4E92\\u8BB0\\u5F55 / Agent Interaction Records\"}),/*#__PURE__*/_jsx(\"button\",{className:\"close-detail\",onClick:()=>setSelectedSentEvent(null),children:\"\\u2715\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-content\",children:(()=>{const sentEvent=getSentEvents()[selectedSentEvent];if(!sentEvent)return null;// 获取与这个发送事件相关的所有响应事件\nconst relatedEvents=getRelatedEvents(sentEvent);return/*#__PURE__*/_jsxs(\"div\",{className:\"interaction-flow\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sent-event-detail\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"section-icon\",children:\"\\uD83D\\uDCE4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"section-title\",children:\"\\u53D1\\u9001\\u7684\\u4E8B\\u4EF6\\u8BE6\\u60C5 / Sent Event Details\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"event-detail-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u4E8B\\u4EF6\\u7C7B\\u578B / Event Type:\"}),\" \",getEventTypeLabel(sentEvent.type)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u53D1\\u9001\\u65F6\\u95F4 / Sent Time:\"}),\" \",new Date(sentEvent.timestamp).toLocaleString()]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u4E8B\\u4EF6\\u8BE6\\u60C5 / Event Details:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"event-payload-detail\",children:renderEventContent(sentEvent.type,sentEvent.payload)})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"agent-visualization\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"section-icon\",children:\"\\uD83C\\uDFAF\"}),/*#__PURE__*/_jsx(\"span\",{className:\"section-title\",children:\"\\u667A\\u80FD\\u4F53\\u4EA4\\u4E92\\u53EF\\u89C6\\u5316 / Agent Interaction Visualization\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"visualization-container\",children:/*#__PURE__*/_jsx(AgentInteractionFlow,{events:events,selectedEvent:sentEvent})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"agent-responses\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-section-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"section-icon\",children:\"\\uD83E\\uDD16\"}),/*#__PURE__*/_jsx(\"span\",{className:\"section-title\",children:\"\\u667A\\u80FD\\u4F53\\u54CD\\u5E94\\u6D41\\u7A0B / Agent Response Flow\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"response-timeline\",children:relatedEvents.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"no-responses\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"no-responses-icon\",children:\"\\u23F3\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u7B49\\u5F85\\u667A\\u80FD\\u4F53\\u54CD\\u5E94 / Waiting for agent responses...\"})]}):relatedEvents.map((event,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"response-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"response-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"response-icon\",children:getEventIcon(event.type)}),/*#__PURE__*/_jsx(\"span\",{className:\"response-type\",children:getEventTypeLabel(event.type)}),/*#__PURE__*/_jsx(\"span\",{className:\"response-time\",children:new Date(event.timestamp).toLocaleTimeString()}),/*#__PURE__*/_jsx(\"button\",{className:\"expand-btn \".concat(expandedEvents.has(\"response_\".concat(selectedSentEvent,\"_\").concat(index))?'expanded':''),onClick:()=>{const eventKey=\"response_\".concat(selectedSentEvent,\"_\").concat(index);const newExpanded=new Set(expandedEvents);if(newExpanded.has(eventKey)){newExpanded.delete(eventKey);}else{newExpanded.add(eventKey);}setExpandedEvents(newExpanded);},children:expandedEvents.has(\"response_\".concat(selectedSentEvent,\"_\").concat(index))?'▼':'▶'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"response-summary\",children:getEventSummary(event)}),expandedEvents.has(\"response_\".concat(selectedSentEvent,\"_\").concat(index))&&/*#__PURE__*/_jsx(\"div\",{className:\"response-details\",children:renderEventContent(event.type,event.payload)})]},index))})]})]});})()})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"detail-placeholder\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"placeholder-icon\",children:\"\\uD83D\\uDC46\"}),/*#__PURE__*/_jsx(\"p\",{className:\"placeholder-text\",children:\"\\u9009\\u62E9\\u5DE6\\u4FA7\\u4E8B\\u4EF6\\u67E5\\u770B\\u667A\\u80FD\\u4F53\\u4EA4\\u4E92\\u8BB0\\u5F55\"}),/*#__PURE__*/_jsx(\"p\",{className:\"placeholder-subtext\",children:\"Click on a sent event to view agent interaction records\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"history-footer\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"footer-stats\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"\\u603B\\u4E8B\\u4EF6 / Total Events:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-value\",children:stats.total})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"\\u663E\\u793A / Showing:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-value\",children:filteredEvents.length})]})]})})]});};export default InteractionHistory;","map":{"version":3,"names":["React","useState","WebSocketService","AgentInteractionFlow","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","InteractionHistory","_ref","events","onClear","onGenerateReport","onOpenReportSidebar","showReportsOnly","onToggleReportsOnly","readyState","connectionStats","connectionError","isRetrying","onRetryConnection","selectedSentEvent","setSelectedSentEvent","expandedEvents","setExpandedEvents","Set","getStatusPill","className","children","onClick","disabled","handleReconnect","reconnect","getEventSummary","event","type","concat","payload","agent","result","substring","total_agents","details","title","getEventIcon","icons","getEventTypeLabel","labels","renderEvent","index","timestamp","time","Date","toLocaleTimeString","icon","typeLabel","eventCard","viewEventDetails","replayEvent","retryEvent","renderEventContent","responses","map","response","report","split","line","location","description","area","alert_type","severity","available_spots","safety_status","require_human_intervention","start_location","end_location","passengers","JSON","stringify","alert","confirm","getEventStats","total","filteredEvents","length","byType","reduce","acc","getSentEvents","sentEventTypes","filter","includes","getSentEventsCount","getSentEventSummary","message","successful_agents","summary","getRelatedEvents","sentEvent","sentTime","timeWindow","responseEventTypes","eventTime","timeDiff","Math","abs","getTime","sort","a","b","getFilteredEvents","stats","userId","activeConnections","totalConnections","relatedEvents","toLocaleString","selectedEvent","has","eventKey","newExpanded","delete","add"],"sources":["/Users/Apple/Desktop/multi-agent-dsl-final/frontend/src/components/InteractionHistory.jsx"],"sourcesContent":["// frontend/src/components/InteractionHistory.jsx\nimport React, { useState } from 'react';\nimport './InteractionHistory.css';\nimport WebSocketService from './WebSocketService';\nimport AgentInteractionFlow from './AgentInteractionFlow';\n\nconst InteractionHistory = ({ \n  events = [], \n  onClear, \n  onGenerateReport, \n  onOpenReportSidebar, \n  showReportsOnly, \n  onToggleReportsOnly, \n  readyState, \n  connectionStats,\n  connectionError,\n  isRetrying,\n  onRetryConnection\n}) => {\n  const [selectedSentEvent, setSelectedSentEvent] = useState(null);\n  const [expandedEvents, setExpandedEvents] = useState(new Set());\n\n  const getStatusPill = () => {\n    if (isRetrying) {\n      return <span className=\"pill pill-status-connecting\">🔄 重连中 / Retrying...</span>;\n    }\n    \n    if (connectionError) {\n      return (\n        <div className=\"connection-error-container\">\n          <span className=\"pill pill-status-closed\">❌ 连接错误 / Connection Error</span>\n          <button \n            className=\"retry-button\" \n            onClick={onRetryConnection}\n            disabled={isRetrying}\n          >\n            🔄 重试 / Retry\n          </button>\n        </div>\n      );\n    }\n    \n    switch (readyState) {\n      case 0: // CONNECTING\n        return <span className=\"pill pill-status-connecting\">🔄 连接中 / Connecting...</span>;\n      case 1: // OPEN\n        return <span className=\"pill pill-status-open\">✅ 已连接 / Connected</span>;\n      case 2: // CLOSING\n        return <span className=\"pill pill-status-closing\">⏳ 断开中 / Disconnecting...</span>;\n      case 3: // CLOSED\n        return (\n          <div className=\"connection-error-container\">\n            <span className=\"pill pill-status-closed\">❌ 服务不可用 / Service Unavailable</span>\n            <button \n              className=\"retry-button\" \n              onClick={onRetryConnection}\n              disabled={isRetrying}\n            >\n              🔄 重试 / Retry\n            </button>\n          </div>\n        );\n      default:\n        return (\n          <div className=\"connection-error-container\">\n            <span className=\"pill pill-status-closed\">❌ 服务不可用 / Service Unavailable</span>\n            <button \n              className=\"retry-button\" \n              onClick={onRetryConnection}\n              disabled={isRetrying}\n            >\n              🔄 重试 / Retry\n            </button>\n          </div>\n        );\n    }\n  };\n\n  const handleReconnect = () => {\n    WebSocketService.reconnect();\n  };\n\n  // 获取事件摘要\n  const getEventSummary = (event) => {\n    switch (event.type) {\n      case 'main_task_result':\n        return `${event.payload.agent}: ${event.payload.result.substring(0, 50)}...`;\n      case 'coordination_result':\n        return `协同完成: ${event.payload.total_agents}个智能体响应`;\n      case 'workflow_complete':\n        return '工作流完成';\n      case 'agent_response':\n        return `${event.payload.agent}: ${event.payload.result.substring(0, 50)}...`;\n      case 'agent_message':\n        return event.payload.substring(0, 50) + '...';\n      case 'analysis_report':\n        return '分析报告已生成';\n      case 'simulation_log':\n        return event.payload.details ? event.payload.details.substring(0, 50) + '...' : '模拟日志';\n      default:\n        return event.title || event.type;\n    }\n  };\n\n  const getEventIcon = (type) => {\n    const icons = {\n      'workflow_start': '🚀',\n      'main_task_result': '👑', // Master Agent 使用皇冠图标\n      'coordination_start': '🤝',\n      'coordination_result': '🎯',\n      'workflow_complete': '🏁',\n      'agent_message': '🤖',\n      'agent_response': '💬',\n      'analysis_report': '📊',\n      'traffic_incident': '🚗',\n      'weather_alert': '🌧️',\n      'parking_update': '🅿️',\n      'safety_inspection': '🛡️',\n      'autonomous_driving': '🚙',\n      'traffic_monitor': '🚦',\n      'simulation_log': '📝',\n      'error': '❌',\n      'ping': '📡',\n      'broadcast': '📡',\n      'main_coordination': '👑',\n      'sub_agent_coordination': '🤝',\n      'sub_agent_processing': '⚙️',\n      'sub_agent_completed': '✅',\n      'result_summary': '📋',\n      'default': '📝'\n    };\n    return icons[type] || icons['default'];\n  };\n\n  const getEventTypeLabel = (type) => {\n    const labels = {\n      'workflow_start': '工作流启动 / Workflow Start',\n      'main_task_result': '主智能体协调 / Master Agent Coordination',\n      'coordination_start': '子智能体协调 / Sub Agent Coordination',\n      'coordination_result': '子智能体协同 / Sub Agent Collaboration',\n      'workflow_complete': '工作流完成 / Workflow Complete',\n      'agent_message': '智能体消息 / Agent Message',\n      'agent_response': '智能体响应 / Agent Response',\n      'analysis_report': '分析报告 / Analysis Report',\n      'traffic_incident': '交通事件 / Traffic Incident',\n      'weather_alert': '天气警报 / Weather Alert',\n      'parking_update': '停车更新 / Parking Update',\n      'safety_inspection': '安全检查 / Safety Inspection',\n      'autonomous_driving': '自动驾驶 / Autonomous Driving',\n      'traffic_monitor': '交通监控 / Traffic Monitor',\n      'simulation_log': '模拟日志 / Simulation Log',\n      'error': '错误 / Error',\n      'ping': '心跳 / Ping',\n      'broadcast': '广播消息 / Broadcast',\n      'main_coordination': '主智能体协调 / Main Coordination',\n      'sub_agent_coordination': '子智能体协调 / Sub Agent Coordination',\n      'sub_agent_processing': '子智能体处理 / Sub Agent Processing',\n      'sub_agent_completed': '子智能体完成 / Sub Agent Completed',\n      'result_summary': '结果汇总 / Result Summary',\n      'default': '未知事件 / Unknown Event'\n    };\n    return labels[type] || labels['default'];\n  };\n\n  const renderEvent = (event, index) => {\n    if (!event) {\n      return <p>No event data</p>;\n    }\n\n    const { type, payload, title, timestamp } = event;\n    const time = timestamp ? new Date(timestamp).toLocaleTimeString() : 'No timestamp';\n    const icon = getEventIcon(type);\n    const typeLabel = getEventTypeLabel(type);\n\n    const eventCard = (\n      <div className={`event-card event-${type}`} key={`${type}-${timestamp || index}-${index}`}>\n        <div className=\"event-header\">\n          <div className=\"event-icon\">{icon}</div>\n          <div className=\"event-info\">\n            <h4 className=\"event-title\">{title || typeLabel}</h4>\n            <span className=\"event-time\">{time}</span>\n          </div>\n          <div className=\"event-actions\">\n            <button \n              className=\"action-btn view-btn\" \n              onClick={() => viewEventDetails(event)}\n              title=\"查看详情 / View Details\"\n            >\n              👁️\n            </button>\n            {type === 'agent_response' && (\n              <button \n                className=\"action-btn replay-btn\" \n                onClick={() => replayEvent(event)}\n                title=\"重放事件 / Replay Event\"\n              >\n                🔄\n              </button>\n            )}\n            {type === 'error' && (\n              <button \n                className=\"action-btn retry-btn\" \n                onClick={() => retryEvent(event)}\n                title=\"重试 / Retry\"\n              >\n                ⚡\n              </button>\n            )}\n          </div>\n        </div>\n        <div className=\"event-content\">\n          {renderEventContent(type, payload)}\n        </div>\n      </div>\n    );\n\n    return eventCard;\n  };\n\n  const renderEventContent = (type, payload) => {\n    switch (type) {\n      case 'workflow_start':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\">{payload}</p>\n          </div>\n        );\n      case 'main_task_result':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\"><strong>{payload.agent}:</strong> {payload.result}</p>\n          </div>\n        );\n      case 'coordination_start':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\">{payload}</p>\n          </div>\n        );\n      case 'coordination_result':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\"><strong>协同完成:</strong> {payload.total_agents}个智能体响应</p>\n            <div className=\"responses-summary\">\n              {payload.responses.map((response, index) => (\n                <div key={index} className=\"response-summary\">\n                  <span className=\"response-agent\">{response.agent}:</span>\n                  <span className=\"response-text\">{response.result.substring(0, 100)}...</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        );\n      case 'workflow_complete':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\">{payload}</p>\n          </div>\n        );\n      case 'agent_message':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\">{payload}</p>\n          </div>\n        );\n      case 'agent_response':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\"><strong>{payload.agent}:</strong> {payload.result}</p>\n          </div>\n        );\n      case 'analysis_report':\n        return (\n          <div className=\"event-payload\">\n            <div className=\"report-content\">\n              <h4 className=\"report-title\">📊 城市分析报告 / City Analysis Report</h4>\n              <div className=\"report-body\">\n                {payload && payload.report ? (\n                  <div className=\"report-text\">\n                    {payload.report.split('\\n').map((line, index) => (\n                      <p key={index} className=\"report-paragraph\">{line}</p>\n                    ))}\n                  </div>\n                ) : (\n                  <p className=\"report-text\">报告内容加载中... / Report content loading...</p>\n                )}\n              </div>\n            </div>\n          </div>\n        );\n      case 'traffic_incident':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\"><strong>位置:</strong> {payload.location} - {payload.description}</p>\n          </div>\n        );\n      case 'weather_alert':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\"><strong>区域:</strong> {payload.area} - <strong>类型:</strong> {payload.alert_type} - <strong>严重程度:</strong> {payload.severity}</p>\n          </div>\n        );\n      case 'parking_update':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\"><strong>位置:</strong> {payload.location} - <strong>可用车位:</strong> {payload.available_spots}</p>\n          </div>\n        );\n      case 'safety_inspection':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\"><strong>位置:</strong> {payload.location} - <strong>安全状态:</strong> {payload.safety_status} - <strong>需要人工干预:</strong> {payload.require_human_intervention ? '是' : '否'}</p>\n          </div>\n        );\n      case 'autonomous_driving':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\"><strong>起点:</strong> {payload.start_location} - <strong>终点:</strong> {payload.end_location} - <strong>乘客数:</strong> {payload.passengers}</p>\n          </div>\n        );\n      case 'traffic_monitor':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\"><strong>交通监控数据:</strong> {JSON.stringify(payload)}</p>\n          </div>\n        );\n      case 'simulation_log':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\">{payload.details || payload}</p>\n          </div>\n        );\n      case 'error':\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-error\">{payload}</p>\n          </div>\n        );\n      case 'ping':\n        return null; // Don't display ping messages\n      default:\n        return (\n          <div className=\"event-payload\">\n            <p className=\"payload-text\">{JSON.stringify(payload)}</p>\n          </div>\n        );\n    }\n  };\n\n  const viewEventDetails = (event) => {\n    alert(`事件详情 / Event Details\\n\\n类型 / Type: ${getEventTypeLabel(event.type)}\\n时间 / Time: ${event.timestamp}\\n\\n详细信息将在模态框中显示 / Detailed information will be shown in a modal.`);\n  };\n\n  const replayEvent = (event) => {\n    if (confirm(`确定要重放此事件吗？ / Are you sure you want to replay this event?`)) {\n      // 这里可以添加重放逻辑\n      alert('事件已重放 / Event replayed successfully!');\n    }\n  };\n\n  const retryEvent = (event) => {\n    if (confirm(`确定要重试此事件吗？ / Are you sure you want to retry this event?`)) {\n      // 这里可以添加重试逻辑\n      alert('事件已重试 / Event retried successfully!');\n    }\n  };\n\n  const getEventStats = () => {\n    const total = filteredEvents.length;\n    const byType = filteredEvents.reduce((acc, event) => {\n      acc[event.type] = (acc[event.type] || 0) + 1;\n      return acc;\n    }, {});\n    return { total, byType };\n  };\n\n  // 获取发送的事件（用户主动发送的事件）\n  const getSentEvents = () => {\n    const sentEventTypes = [\n      'weather_alert', \n      'parking_update', \n      'safety_inspection', \n      'autonomous_driving', \n      'traffic_monitor',\n      'broadcast',\n      'main_coordination',\n      'sub_agent_coordination',\n      'sub_agent_processing',\n      'sub_agent_completed',\n      'result_summary',\n      'coordination_result',\n      'analysis_report'\n    ];\n    return events.filter(event => sentEventTypes.includes(event.type));\n  };\n\n  // 获取发送事件数量\n  const getSentEventsCount = () => {\n    return getSentEvents().length;\n  };\n\n  // 获取发送事件摘要\n  const getSentEventSummary = (event) => {\n    if (!event) {\n      return '未知事件';\n    }\n    \n    // 如果有title，优先使用title\n    if (event.title) {\n      return event.title;\n    }\n    \n    // 如果有payload，根据类型生成摘要\n    if (event.payload) {\n      switch (event.type) {\n        case 'weather_alert':\n          return `区域: ${event.payload.area || '未知'} - 类型: ${event.payload.alert_type || '未知'}`;\n        case 'parking_update':\n          return `位置: ${event.payload.location || '未知'} - 可用车位: ${event.payload.available_spots || '未知'}`;\n        case 'safety_inspection':\n          return `位置: ${event.payload.location || '未知'} - 状态: ${event.payload.safety_status || '未知'}`;\n        case 'autonomous_driving':\n          return `起点: ${event.payload.start_location || '未知'} - 终点: ${event.payload.end_location || '未知'}`;\n        case 'traffic_monitor':\n          return `交通监控数据`;\n        case 'broadcast':\n          return event.payload.payload || event.payload.message || '广播消息';\n        case 'main_coordination':\n          return event.payload.result || '主智能体协调任务';\n        case 'sub_agent_coordination':\n          return event.payload || '子智能体协调开始';\n        case 'sub_agent_processing':\n          return event.payload.agent || '子智能体处理中';\n        case 'sub_agent_completed':\n          return event.payload.result || '子智能体处理完成';\n        case 'result_summary':\n          return `总计: ${event.payload.total_agents || 0} 个智能体, 成功: ${event.payload.successful_agents || 0} 个`;\n        case 'coordination_result':\n          return event.payload.summary || '智能体协同完成';\n        case 'analysis_report':\n          return event.payload.report ? event.payload.report.substring(0, 100) + '...' : '分析报告';\n        default:\n          return event.type || '未知事件';\n      }\n    }\n    \n    return event.type || '未知事件';\n  };\n\n  // 获取与发送事件相关的响应事件\n  const getRelatedEvents = (sentEvent) => {\n    if (!sentEvent || !sentEvent.timestamp) {\n      return [];\n    }\n    \n    const sentTime = new Date(sentEvent.timestamp);\n    const timeWindow = 10 * 60 * 1000; // 增加到10分钟时间窗口\n    \n    // 定义智能体响应事件类型\n    const responseEventTypes = [\n      'workflow_start',\n      'main_task_result', \n      'coordination_start',\n      'coordination_result',\n      'workflow_complete',\n      'agent_message',\n      'agent_response',\n      'analysis_report',\n      'simulation_log'\n    ];\n    \n    return events.filter(event => {\n      if (!event || !event.timestamp) return false;\n      \n      const eventTime = new Date(event.timestamp);\n      const timeDiff = Math.abs(eventTime.getTime() - sentTime.getTime());\n      \n      // 在时间窗口内，是响应事件类型，且不是发送事件本身\n      return timeDiff <= timeWindow && \n             responseEventTypes.includes(event.type) && \n             event.type !== sentEvent.type;\n    }).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));\n  };\n\n  // 过滤事件 - 如果只显示报告，则只显示报告类型的事件\n  const getFilteredEvents = () => {\n    if (showReportsOnly) {\n      return events.filter(event => event.type === 'analysis_report');\n    }\n    return events;\n  };\n\n  const filteredEvents = getFilteredEvents();\n  const stats = getEventStats();\n\n  return (\n    <div className=\"interaction-record card\">\n      <div className=\"history-header\">\n        <h2 className=\"card__title\">📊 交互历史 / Interaction History</h2>\n        <div className=\"header-controls\">\n          {getStatusPill()}\n          {connectionStats && (\n            <span className=\"pill pill-info\">\n              📡 {connectionStats.userId ? connectionStats.userId.substring(0, 8) + '...' : 'Unknown'}\n            </span>\n          )}\n        </div>\n        {connectionError && (\n          <div className=\"connection-error-message\">\n            <span className=\"error-icon\">⚠️</span>\n            <span className=\"error-text\">{connectionError}</span>\n          </div>\n        )}\n      </div>\n      \n      {/* 连接状态信息 */}\n      <div className=\"connection-info\">\n        <div className=\"connection-details\">\n          <span className=\"connection-item\">\n            <strong>消息数 / Messages:</strong> {events.length}\n          </span>\n          <span className=\"connection-item\">\n            <strong>后端 / Backend:</strong> http://localhost:8008\n          </span>\n          {connectionStats && (\n            <>\n              <span className=\"connection-item\">\n                <strong>用户ID / User ID:</strong> {connectionStats.userId}\n              </span>\n              <span className=\"connection-item\">\n                <strong>活跃连接 / Active Connections:</strong> {connectionStats.activeConnections}/{connectionStats.totalConnections}\n              </span>\n            </>\n          )}\n        </div>\n      </div>\n\n      <div className=\"history-controls\">\n        <div className=\"action-buttons\">\n          <button onClick={onOpenReportSidebar} className=\"report-sidebar-btn\">\n            📊 交互报告 / Interaction Report\n          </button>\n          <button onClick={onGenerateReport} className=\"generate-btn\">\n            📄 生成报告 / Generate Report\n          </button>\n          <button onClick={onClear} className=\"clear-btn\">\n            🗑️ 清空历史 / Clear History\n          </button>\n          <button \n            onClick={onToggleReportsOnly} \n            className={`view-reports-btn ${showReportsOnly ? 'active' : ''}`}\n          >\n            {showReportsOnly ? '📋 显示全部 / Show All' : '📊 查看报告 / View Reports'}\n          </button>\n        </div>\n      </div>\n\n      <div className=\"history-layout\">\n        {/* 左侧：发送的事件详情 */}\n        <div className=\"sent-events-sidebar\">\n          <div className=\"sidebar-header\">\n            <h3>{showReportsOnly ? '📊 报告信息 / Report Info' : '📤 发送的事件 / Sent Events'}</h3>\n            <span className=\"event-count\">\n              {showReportsOnly ? `${filteredEvents.length} 个报告` : `${getSentEventsCount()} 个事件`}\n            </span>\n          </div>\n          <div className=\"sent-events-list\">\n            {showReportsOnly ? (\n              // 报告模式：显示报告相关信息\n              filteredEvents.length === 0 ? (\n                <div className=\"empty-state\">\n                  <div className=\"empty-icon\">📄</div>\n                  <p className=\"empty-text\">暂无生成的报告 / No reports generated yet</p>\n                  <p className=\"empty-subtext\">点击\"生成报告\"按钮创建报告 / Click \"Generate Report\" to create reports</p>\n                </div>\n              ) : (\n                filteredEvents.map((report, index) => (\n                  <div key={index} className=\"report-summary-item\">\n                    <div className=\"event-header\">\n                      <span className=\"event-icon\">📊</span>\n                      <div className=\"event-info\">\n                        <div className=\"event-title\">{report.title || '城市分析报告'}</div>\n                        <div className=\"event-meta\">\n                          <span className=\"event-time\">{report.timestamp ? new Date(report.timestamp).toLocaleTimeString() : '未知时间'}</span>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"event-summary\">\n                      {report.payload && report.payload.report ? \n                        `报告摘要: ${report.payload.report.substring(0, 100)}...` : \n                        '报告内容加载中...'\n                      }\n                    </div>\n                  </div>\n                ))\n              )\n            ) : (\n              // 正常模式：显示发送事件\n              getSentEvents().length === 0 ? (\n                <div className=\"empty-state\">\n                  <div className=\"empty-icon\">📭</div>\n                  <p className=\"empty-text\">暂无发送事件 / No sent events yet</p>\n                  <p className=\"empty-subtext\">发送任务以查看事件详情 / Send tasks to view event details</p>\n                </div>\n              ) : (\n                getSentEvents().map((event, index) => (\n                  <div \n                    key={index} \n                    className={`sent-event-item ${selectedSentEvent === index ? 'selected' : ''}`}\n                    onClick={() => setSelectedSentEvent(index)}\n                  >\n                    <div className=\"event-header\">\n                      <span className=\"event-icon\">{getEventIcon(event.type)}</span>\n                      <div className=\"event-info\">\n                        <div className=\"event-title\">{getEventTypeLabel(event.type)}</div>\n                        <div className=\"event-meta\">\n                          <span className=\"event-time\">{event.timestamp ? new Date(event.timestamp).toLocaleTimeString() : '未知时间'}</span>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"event-summary\">\n                      {getSentEventSummary(event)}\n                    </div>\n                  </div>\n                ))\n              )\n            )}\n          </div>\n        </div>\n\n        {/* 右侧：交互记录和智能体响应 */}\n        <div className=\"interactions-detail\">\n          {selectedSentEvent !== null ? (\n            <div className=\"detail-view\">\n              <div className=\"detail-header\">\n                <h3>🤖 智能体交互记录 / Agent Interaction Records</h3>\n                <button \n                  className=\"close-detail\"\n                  onClick={() => setSelectedSentEvent(null)}\n                >\n                  ✕\n                </button>\n              </div>\n              <div className=\"detail-content\">\n                {(() => {\n                  const sentEvent = getSentEvents()[selectedSentEvent];\n                  if (!sentEvent) return null;\n                  \n                  // 获取与这个发送事件相关的所有响应事件\n                  const relatedEvents = getRelatedEvents(sentEvent);\n                  \n                  return (\n                    <div className=\"interaction-flow\">\n                      {/* 显示发送的事件详情 */}\n                      <div className=\"sent-event-detail\">\n                        <div className=\"detail-section-header\">\n                          <span className=\"section-icon\">📤</span>\n                          <span className=\"section-title\">发送的事件详情 / Sent Event Details</span>\n                        </div>\n                        <div className=\"event-detail-content\">\n                          <div className=\"detail-item\">\n                            <strong>事件类型 / Event Type:</strong> {getEventTypeLabel(sentEvent.type)}\n                          </div>\n                          <div className=\"detail-item\">\n                            <strong>发送时间 / Sent Time:</strong> {new Date(sentEvent.timestamp).toLocaleString()}\n                          </div>\n                          <div className=\"detail-item\">\n                            <strong>事件详情 / Event Details:</strong>\n                            <div className=\"event-payload-detail\">\n                              {renderEventContent(sentEvent.type, sentEvent.payload)}\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* 显示智能体交互可视化 */}\n                      <div className=\"agent-visualization\">\n                        <div className=\"detail-section-header\">\n                          <span className=\"section-icon\">🎯</span>\n                          <span className=\"section-title\">智能体交互可视化 / Agent Interaction Visualization</span>\n                        </div>\n                        <div className=\"visualization-container\">\n                          <AgentInteractionFlow \n                            events={events} \n                            selectedEvent={sentEvent}\n                          />\n                        </div>\n                      </div>\n\n                      {/* 显示智能体响应流程 */}\n                      <div className=\"agent-responses\">\n                        <div className=\"detail-section-header\">\n                          <span className=\"section-icon\">🤖</span>\n                          <span className=\"section-title\">智能体响应流程 / Agent Response Flow</span>\n                        </div>\n                        <div className=\"response-timeline\">\n                          {relatedEvents.length === 0 ? (\n                            <div className=\"no-responses\">\n                              <div className=\"no-responses-icon\">⏳</div>\n                              <p>等待智能体响应 / Waiting for agent responses...</p>\n                            </div>\n                          ) : (\n                            relatedEvents.map((event, index) => (\n                              <div key={index} className=\"response-item\">\n                                <div className=\"response-header\">\n                                  <span className=\"response-icon\">{getEventIcon(event.type)}</span>\n                                  <span className=\"response-type\">{getEventTypeLabel(event.type)}</span>\n                                  <span className=\"response-time\">{new Date(event.timestamp).toLocaleTimeString()}</span>\n                                  <button \n                                    className={`expand-btn ${expandedEvents.has(`response_${selectedSentEvent}_${index}`) ? 'expanded' : ''}`}\n                                    onClick={() => {\n                                      const eventKey = `response_${selectedSentEvent}_${index}`;\n                                      const newExpanded = new Set(expandedEvents);\n                                      if (newExpanded.has(eventKey)) {\n                                        newExpanded.delete(eventKey);\n                                      } else {\n                                        newExpanded.add(eventKey);\n                                      }\n                                      setExpandedEvents(newExpanded);\n                                    }}\n                                  >\n                                    {expandedEvents.has(`response_${selectedSentEvent}_${index}`) ? '▼' : '▶'}\n                                  </button>\n                                </div>\n                                \n                                {/* 响应摘要 */}\n                                <div className=\"response-summary\">\n                                  {getEventSummary(event)}\n                                </div>\n                                \n                                {/* 展开的详细响应 */}\n                                {expandedEvents.has(`response_${selectedSentEvent}_${index}`) && (\n                                  <div className=\"response-details\">\n                                    {renderEventContent(event.type, event.payload)}\n                                  </div>\n                                )}\n                              </div>\n                            ))\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  );\n                })()}\n              </div>\n            </div>\n          ) : (\n            <div className=\"detail-placeholder\">\n              <div className=\"placeholder-icon\">👆</div>\n              <p className=\"placeholder-text\">选择左侧事件查看智能体交互记录</p>\n              <p className=\"placeholder-subtext\">Click on a sent event to view agent interaction records</p>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"history-footer\">\n        <div className=\"footer-stats\">\n          <span className=\"stat-item\">\n            <span className=\"stat-label\">总事件 / Total Events:</span>\n            <span className=\"stat-value\">{stats.total}</span>\n          </span>\n          <span className=\"stat-item\">\n            <span className=\"stat-label\">显示 / Showing:</span>\n            <span className=\"stat-value\">{filteredEvents.length}</span>\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default InteractionHistory;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}